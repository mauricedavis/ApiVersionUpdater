<template>
    <div class="slds-grid slds-gutters slds-wrap">
        
        <!-- Compliance Overview Section -->
        <div class="slds-col slds-size_1-of-1 slds-m-bottom_medium">
            <lightning-card title="Compliance Overview" icon-name="utility:target">
                <div slot="actions">
                    <span class="target-badge">Target: API {targetVersion}</span>
                </div>
                <div class="slds-p-around_medium">
                    <template lwc:if={hasComplianceData}>
                        <div class="slds-grid slds-gutters slds-wrap">
                            <!-- Compliance Ring -->
                            <div class="slds-col slds-size_1-of-4 slds-text-align_center">
                                <div class="compliance-ring-container">
                                    <div class="compliance-ring" style={complianceRingStyle}>
                                        <div class="compliance-ring-inner">
                                            <span class={complianceTextColor}>{compliancePercentage}%</span>
                                        </div>
                                    </div>
                                    <div class="slds-m-top_small">
                                        <span class={complianceStatusClass}>{complianceStatusLabel}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Summary Stats -->
                            <div class="slds-col slds-size_3-of-4">
                                <!-- Action Buttons Row - Above Stats -->
                                <div class="slds-grid slds-gutters slds-m-bottom_medium">
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-button 
                                            variant="brand" 
                                            label="Start Compliance Scan" 
                                            icon-name="utility:search"
                                            onclick={handleStartScan}
                                            class="slds-m-right_small">
                                        </lightning-button>
                                        <lightning-button 
                                            variant="neutral" 
                                            label="Refresh" 
                                            icon-name="utility:refresh"
                                            onclick={handleRefresh}>
                                        </lightning-button>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2 slds-text-align_right">
                                        <div class="version-range">
                                            <lightning-icon icon-name="utility:trending" size="x-small" class="slds-m-right_x-small"></lightning-icon>
                                            Version Range: <strong>{oldestVersion}</strong> to <strong>{newestVersion}</strong>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Stats Cards Row -->
                                <div class="slds-grid slds-gutters slds-wrap">
                                    <div class="slds-col slds-size_1-of-4">
                                        <div class="stat-card">
                                            <div class="stat-value">{totalComponents}</div>
                                            <div class="stat-label">Total Components</div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-4">
                                        <div class="stat-card stat-success">
                                            <div class="stat-value">{compliantCount}</div>
                                            <div class="stat-label">At Target or Above</div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-4">
                                        <div class="stat-card stat-error">
                                            <div class="stat-value">{nonCompliantCount}</div>
                                            <div class="stat-label">Need Upgrade</div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-4">
                                        <div class="stat-card">
                                            <div class="stat-value">{versionsToUpgrade}</div>
                                            <div class="stat-label">Max Version Gap</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    <template lwc:else>
                        <div class="slds-text-align_center slds-p-around_large">
                            <lightning-icon icon-name="utility:info" size="large" class="slds-m-bottom_small"></lightning-icon>
                            <p class="slds-text-heading_small">No compliance data available</p>
                            <p class="slds-text-body_regular slds-text-color_weak">Click refresh to load compliance metrics</p>
                            <lightning-button 
                                variant="brand" 
                                label="Load Compliance Data" 
                                icon-name="utility:refresh"
                                onclick={handleRefresh}
                                class="slds-m-top_medium">
                            </lightning-button>
                        </div>
                    </template>
                </div>
            </lightning-card>
        </div>

        <!-- Compliance by Type -->
        <div class="slds-col slds-size_1-of-1 slds-m-bottom_medium">
            <lightning-card title="Compliance by Component Type" icon-name="utility:metrics">
                <div class="slds-p-around_medium">
                    <div class="slds-grid slds-gutters slds-wrap">
                        <template for:each={typeComplianceCards} for:item="card">
                            <div key={card.type} class="slds-col slds-size_1-of-4">
                                <div class="type-card">
                                    <div class="type-card-header">
                                        <lightning-icon icon-name={card.icon} size="small" class="slds-m-right_x-small"></lightning-icon>
                                        <span class="type-card-title">{card.label}</span>
                                        <lightning-icon icon-name={card.statusIcon} variant={card.statusVariant} size="x-small" class="type-status-icon"></lightning-icon>
                                    </div>
                                    <div class="type-card-body">
                                        <div class="type-percentage">{card.percentage}%</div>
                                        <div class="type-progress-container">
                                            <div class={card.progressClass} style={card.progressStyle}></div>
                                        </div>
                                        <div class="type-details">
                                            <span class="detail-compliant">{card.compliant} compliant</span>
                                            <span class="detail-separator">|</span>
                                            <span class="detail-non-compliant">{card.nonCompliant} to upgrade</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </lightning-card>
        </div>

        <!-- Version Distribution Chart -->
        <div class="slds-col slds-size_1-of-1">
            <lightning-card title="API Version Distribution" icon-name="utility:chart">
                <div slot="actions">
                    <lightning-combobox
                        name="distributionType"
                        label=""
                        value={selectedDistributionType}
                        options={typeOptions}
                        onchange={handleTypeChange}
                        variant="label-hidden"
                        class="type-selector">
                    </lightning-combobox>
                </div>
                <div class="slds-p-around_medium">
                    <template lwc:if={hasDistributionData}>
                        <div class="distribution-legend slds-m-bottom_small">
                            <span class="legend-item">
                                <span class="legend-color legend-compliant"></span> At or above target (API {targetVersion})
                            </span>
                            <span class="legend-item">
                                <span class="legend-color legend-non-compliant"></span> Below target (needs upgrade)
                            </span>
                        </div>
                        <div class="version-bars">
                            <template for:each={distributionBars} for:item="bar">
                                <div key={bar.version} class="slds-grid version-bar-row">
                                    <div class="slds-col slds-size_1-of-12 slds-text-align_right slds-p-right_small">
                                        <span class={bar.versionClass}>{bar.version}</span>
                                    </div>
                                    <div class="slds-col slds-size_9-of-12">
                                        <div class="bar-container">
                                            <div class={bar.barClass} style={bar.barStyle}></div>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_2-of-12 slds-p-left_small">
                                        <span class="bar-count">{bar.count} components</span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <template lwc:else>
                        <div class="slds-text-align_center slds-text-color_weak slds-p-around_large">
                            No distribution data available
                        </div>
                    </template>
                </div>
            </lightning-card>
        </div>
    </div>
</template>
